#!/bin/bash

# This creates the JCL needed to build DSSDUMP (apparently)

## JOBCARD
cat << END
//DSSDUMP JOB (JOB),
//             'INSTALL DSSDUMP', 
//             CLASS=A,
//             MSGCLASS=A,
//             MSGLEVEL=(1,1),
//             USER=IBMUSER,
//             PASSWORD=SYS1
//*
//* THIS JCL WAS GENERATED AUTOMATICALLY BY make_release.sh
//*
END

for NAME in SUBCPOOL SUBLPALK SUBCAT SUBCOMP SUBTREE SUBVERB SUBVTVAL SUBXTSUM; do
cat << END
//$NAME EXEC ASMFC,PARM='DECK,LIST,OBJECT'
//SYSLIB DD DSN=SYS1.MACLIB,DISP=SHR
//       DD DSN=SYS2.PVTMACS,DISP=SHR
//       DD DSN=SYS2.ESPMAC,DISP=SHR
//       DD DSN=SYS1.AMACLIB,DISP=SHR
//       DD DSN=SYS1.AMODGEN,DISP=SHR
//SYSIN DD DATA,DLM=@@
END
cat $NAME.hlasm
echo "@@"
echo "//SYSGO DD DSN=&&OBJSET,UNIT=SYSDA,SPACE=(CYL,1),DISP=(MOD,PASS)"
done

cat << END
//DSSDUMP EXEC ASMFCL,PARM='NODECK,NOLIST,OBJECT'
//SYSLIB DD DSN=SYS1.MACLIB,DISP=SHR
//       DD DSN=SYS2.PVTMACS,DISP=SHR
//       DD DSN=SYS2.ESPMAC,DISP=SHR
//       DD DSN=SYS1.AMACLIB,DISP=SHR
//       DD DSN=SYS1.AMODGEN,DISP=SHR
//SYSIN DD DATA,DLM=@@
END

#cat dssdump.orig.hlasm
cat DSSDUMP.hlasm

cat << END
@@
//LKED.SYSLMOD DD DSN=SYSC.LINKLIB(DSSDUMP),DISP=SHR
END